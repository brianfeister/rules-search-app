<!DOCTYPE html>
<html>
<head>
  <title>Rules Search App</title>
  <script src="assets/js/powers.js"></script>
  <script src="assets/js/lodash.js"></script>

  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
  <!-- Angular Material Dependencies -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-animate.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-aria.min.js"></script>


  <!-- Angular Material Javascript now available via Google CDN; version 0.9 used here -->
  <script src="assets/js/angular-material.js"></script>

  <link href="assets/css/angular-material.css" media="all" rel="stylesheet">
  <link href="assets/css/style.css" media="all" rel="stylesheet">


  <script>
    angular.module('rulesApp', ['ngMaterial'])
      .controller('searchCtrl', function ($scope, $filter) {
        console.log('Hello from "searchCtrl"');
        $scope.powers = window.powers;
        $scope.searchQuery = '';
        $scope.searchFilter = function (item) {
          // if `searchQuery` is empty, we want to show all list items
          if ( $scope.searchQuery === '' && $scope.selectedAttributes.length === 0 ) {
            return true;
          }
          var regex = new RegExp($scope.searchQuery, 'gi');
          var show = false; // initially we assume that we won't show a given result
          var inAttackFilter = true;
          // now we look for matches in the following object properties
          show = item.name.match(regex) || item.description.match(regex) || item.effect.match(regex);
          // if the selectedAttributes array is longer than 0, we need to show
          // only results that match one of the selected properties
          if ( $scope.selectedAttributes.length > 0 ) {
            var searchAttrs = angular.copy( $scope.selectedAttributes );
            var inAttackFilter = _.intersection( item.attackAttributes, searchAttrs ).length > 0;
          }
          // return the result (either `true` or `false`)
          return show && inAttackFilter;
        }
        $scope.attackAttributes = [
          'Agility',
          'Enchantment',
          'Entropy',
          'Might',
          'Energy',
          'Illusion',
          'Psychic',
          'Divination'
        ];
        $scope.selectedAttributes = [];
        $scope.attackAttrSearchText = '';
        $scope.updateSearchTextModel = function (value) {
          $scope.attackAttrSearchText = value;
        };
        $scope.attackAttrSearchFilter = function (item,index,array) {
          // return all the options if the user hasn't selected a filter
          if ( $scope.attackAttrSearchText === '' ){
            return true;
          }
          return item.toLowerCase().match($scope.attackAttrSearchText.toLowerCase());
        };
      });
  </script>
</head>
<body ng-app="rulesApp" layout="column" ng-controller="searchCtrl">
  <md-toolbar class="md-default-theme">
    <div class="md-toolbar-tools">
    <h1>
      <span>Rules Search</span>
    </h1>
    </div>
  </md-toolbar>
    <md-toolbar md-scroll-shrink>

      <div layout="row">
        <div class="left-search" flex layout-padding>
        <md-autocomplete
            md-min-length="0"
            md-items="item in []"
            md-item-text="item.name"
            md-search-text="searchQuery"
            placeholder="Text Search">
        </md-autocomplete>

        </div>
        <md-chips ng-model="selectedAttributes" md-autocomplete-snap flex layout-padding>
          <md-autocomplete
              md-min-length="0"
              md-search-text="attackAttrSearchText"
              md-search-text-change="updateSearchTextModel(attackAttrSearchText)"
              md-selected-item="selectedItem"
              md-items="item in attackAttributes | filter:attackAttrSearchFilter"
              md-item-text="item.name"
              placeholder="Attack Attributes">
            <span md-highlight-text="attackAttrSearchText">{{item}}</span>
          </md-autocomplete>
          <md-chip-template>
            <span>
              <strong>{{$chip}}</strong>
            </span>
          </md-chip-template>
        </md-chips>

      </div>

    </md-toolbar>



  <md-content>
    <md-list>

        <md-list-item ng-repeat="thisPower in powers | filter:searchFilter">
          <div class="md-list-item-text">
            <h3>{{thisPower.name}}</h3>
            <strong>Duration:</strong> {{thisPower.duration}}
            <br><br>
            <strong>Power Level:</strong><br>
            <ul>
              <li ng-repeat="power in thisPower.power">
                {{power}}
              </li>
            </ul>
            <strong>Tags:</strong><br>
            <ul>
              <li ng-repeat="tag in thisPower.tags">
                {{tag}}
              </li>
            </ul>
            <strong>Attack Attributes:</strong><br>
            <ul>
              <li ng-repeat="attack in thisPower.attackAttributes">
                {{attack}}
              </li>
            </ul>
            <div ng-if="thisPower.description">
              <h3>Description</h3>
              {{thisPower.description}}
            </div>
            <div ng-if="thisPower.effect">
              <h3>Effect</h3>
              {{thisPower.effect}}
            </div>
            <div ng-if="thisPower.special">
              <h3>Special</h3>
              {{thisPower.special}}
            </div>
          </div>
          <md-divider ng-if="!$last"></md-divider>
        </md-list-item>

    </md-list>
  </md-content>
</body>
</html>
